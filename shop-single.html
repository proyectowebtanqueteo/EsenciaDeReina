<!DOCTYPE html>
<html lang="en">

<head>
    <title>Productos</title>
    <meta charset="utf-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="assets/img/apple-icon.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <link rel="stylesheet" href="assets/css/custom.css">

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <style>
        .ms-custom {
            margin-left: 20rem !important;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="assets/css/slick.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/slick-theme.css">

</head>

<body>
    <div id="navbar-placeholder"></div>

    <div class="modal fade bg-white" id="templatemo_search" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="w-100 pt-1 mb-5 text-right">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="" method="get" class="modal-content modal-body border-0 p-0">
                <div class="input-group mb-2">
                    <input type="text" class="form-control" id="inputModalSearch" name="q" placeholder="Search ...">
                    <button type="submit" class="input-group-text bg-success text-light">
                        <i class="fa fa-fw fa-search text-white"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <section class="bg-light">
        <div class="container pb-5">
            <div class="row">
                <div class="col-lg-5 mt-5">
                    <div class="card mb-3 d-flex justify-content-center" id="product-viewer">
                        <img class="card-img img-fluid" src="" alt="Product Image" id="product-detail">
                    </div>
                    <div class="row justify-content-center">
                        <div id="multi-item-example" class="col-10 carousel slide carousel-multi-item"
                            data-bs-ride="carousel" data-bs-interval="100000">
                            <div class="carousel-inner product-links-wap" role="listbox">
                                <div class="carousel-item active">
                                    <div class="row justify-content-center text-center" id="miniaturas-row"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7 mt-5">
                    <div class="card">
                        <div class="card-body">
                            <h1 class="h2" id="product-name"></h1>
                            <p class="h3 py-2" id="product-price"></p>

                            <h6>Descripción:</h6>
                            <p class="product-description" id="product-description"></p>
                            <ul class="list-inline">
                                <li class="list-inline-item">
                                    <h6>Color disponible :</h6>
                                </li>
                                <li class="list-inline-item" id="product-color"></li>
                            </ul>

                            <h6>Especificaciones:</h6>
                            <ul id="product-specs"></ul>

                            <form action="" method="GET" id="product-form">
                                <input type="hidden" name="product-title" value="">
                                <div class="row">
                                    <div class="col-auto"></div>
                                    <div class="col-auto">
                                        <ul class="list-inline pb-3">
                                            <li class="list-inline-item text-right">
                                                Cantidad
                                                <input type="hidden" name="product-quanity" id="product-quanity"
                                                    value="1">
                                            </li>
                                            <li class="list-inline-item"><span class="btn btn-success"
                                                    id="btn-minus">-</span></li>
                                            <li class="list-inline-item"><span class="badge bg-secondary"
                                                    id="var-value">1</span></li>
                                            <li class="list-inline-item"><span class="btn btn-success"
                                                    id="btn-plus">+</span></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col d-grid">
                                        <button type="submit" class="btn btn-success btn-lg" name="submit" value="buy"
                                            id="buy-btn">Comprar</button>
                                    </div>
                                    <div class="col d-grid">
                                        <button type="button" class="btn btn-success btn-lg" name="submit"
                                            value="addtocard" id="add-to-cart-btn">Añadir al Carrito</button>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-placeholder"></div>

    <script src="assets/js/jquery-1.11.0.min.js"></script>
    <script src="assets/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/templatemo.js"></script>
    <script src="assets/js/custom.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Redirigir si no hay producto seleccionado
            const product = JSON.parse(localStorage.getItem('selectedProduct'));
            if (!product) {
                document.getElementById('product-name').textContent = 'Producto no encontrado';
                document.getElementById('product-price').textContent = '$0.00';
                document.getElementById('product-description').textContent = 'Por favor, selecciona un producto desde la tienda.';
                return;
            }

            // Renderizar datos del producto
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('product-description').textContent = product.description;

            const colorElem = document.getElementById('product-color');
            if (colorElem && product.color) {
                colorElem.innerHTML = `<strong>${product.color}</strong>`;
            }

            const specsElem = document.getElementById('product-specs');
            if (specsElem && product.specifications) {
                specsElem.innerHTML = '';
                product.specifications.forEach(spec => {
                    const li = document.createElement('li');
                    li.textContent = spec;
                    specsElem.appendChild(li);
                });
            }

            // Imagen principal
            const mainImg = document.getElementById('product-detail');
            if (mainImg && product.images && product.images.length > 0) {
                mainImg.src = product.images[0];
                mainImg.alt = product.name;
            }

            // Miniaturas
            const miniaturasRow = document.getElementById('miniaturas-row');
            if (miniaturasRow && product.images && product.images.length > 0) {
                miniaturasRow.innerHTML = '';
                product.images.forEach((imgSrc, idx) => {
                    const col = document.createElement('div');
                    col.className = 'col-4';
                    const a = document.createElement('a');
                    a.href = '#';
                    a.className = 'thumb-link';
                    a.setAttribute('data-type', 'image');
                    a.setAttribute('data-src', imgSrc);
                    const img = document.createElement('img');
                    img.className = 'card-img img-fluid thumb-img';
                    img.src = imgSrc;
                    img.alt = `${product.name} - Vista ${idx + 1}`;
                    img.style.cursor = 'pointer';
                    a.appendChild(img);
                    col.appendChild(a);
                    miniaturasRow.appendChild(col);
                });

                // Event listeners para miniaturas
                miniaturasRow.querySelectorAll('.thumb-link').forEach(function (link) {
                    link.addEventListener('click', function (e) {
                        e.preventDefault();
                        const src = this.getAttribute('data-src');
                        const viewer = document.getElementById('product-detail');
                        if (viewer) {
                            viewer.src = src;
                        }
                    });
                });
            }

            // Cantidad
            let quantity = 1;
            const qtyBadge = document.getElementById('var-value');
            const btnMinus = document.getElementById('btn-minus');
            const btnPlus = document.getElementById('btn-plus');

            if (btnMinus) {
                btnMinus.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (quantity > 1) {
                        quantity--;
                        qtyBadge.textContent = quantity;
                    }
                });
            }

            if (btnPlus) {
                btnPlus.addEventListener('click', function (e) {
                    e.preventDefault();
                    quantity++;
                    qtyBadge.textContent = quantity;
                });
            }

            // Comprar
            const buyBtn = document.getElementById('buy-btn');
            if (buyBtn) {
                buyBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const now = new Date();
                    const hour = now.getHours();
                    let saludo = 'Buenas tardes';
                    if (hour < 12) saludo = 'Buenos días';
                    else if (hour >= 19) saludo = 'Buenas noches';

                    const mensaje = `${saludo}, estoy interesad@ en este producto:\n- ${product.name} (Cantidad: ${quantity})\nTotal: $${(product.price * quantity).toFixed(2)}`;
                    const numero = '19452179299';
                    const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
                    window.open(url, '_blank');
                });
            }

            // Añadir al carrito
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const productWithImg = {
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        img: product.images && product.images.length > 0 ? product.images[0] : '',
                    };
                    for (let i = 0; i < quantity; i++) {
                        if (typeof window.addToCart === 'function') {
                            window.addToCart(productWithImg);
                        }
                    }
                    alert(`${product.name} añadido al carrito (${quantity} unidad${quantity > 1 ? 'es' : ''})`);
                });
            }
        });
    </script>
</body>

</html>